import json
import argparse
import re
import os

pattern = '.*github.com.*commit.*'

parser = argparse.ArgumentParser(description='Get URLs for matching CWEs from CVE files')
parser.add_argument('--a', metavar='N1', help='CVE folder', required=True)
parser.add_argument('--b', nargs='*', metavar='N2', help='zero or more CWEs', default = [])
args = parser.parse_args()

cve_folder = args.a + '/'
cwe_id = args.b

with os.scandir(cve_folder) as entries:
    for entry in entries:
        if entry.is_file() and (not entry.name.endswith(".DS_Store")):
            with open(entry) as f:
                data = json.load(f)
                for item in data['CVE_Items']:
                    for cwe in item['cve']['problemtype']['problemtype_data']:
                        for desc in cwe['description']:
                            for id in cwe_id:
                                if desc['value'] == id:
                                    for ref_data in item['cve']['references']['reference_data']:
                                        result = re.match(pattern, ref_data['url'],)
                                        if result:
                                            print(ref_data['url'])
